# TASK-0008: Create Transaction Model - Implementation Plan

## Task Description
Define Transaction entity as Isar database model with fields: id, type (debt/loan), name, amount, currency, description, dueDate, status

## Prerequisites
- Flutter project initialized ✓
- Isar database configured ✓
- isar_community package installed ✓

## Implementation Steps

### 1. Add Required Dependencies
- Verify `isar_community` is in dependencies ✓
- Verify `isar_community_generator` is in dev_dependencies ✓
- Verify `build_runner` is in dev_dependencies ✓

### 2. Create Transaction Model File
**Location:** `lib/data/models/transaction.dart`

**Fields to implement:**
- `Id id` - Isar auto-increment ID (default: Isar.autoIncrement)
- `@Enumerated(EnumType.name) TransactionType type` - Enum: debt or loan
- `String name` - Transaction party name (required, non-empty)
- `int amount` - Initial amount in smallest currency unit (required, positive)
- `@Enumerated(EnumType.name) Currency currency` - Enum: PLN, EUR, USD, GBP
- `String? description` - Optional description (max 200 characters)
- `DateTime? dueDate` - Optional due date
- `@Enumerated(EnumType.name) TransactionStatus status` - Enum: active or completed
- `DateTime createdAt` - Creation timestamp
- `DateTime updatedAt` - Last update timestamp

### 3. Create Supporting Enums

**TransactionType enum** (`lib/data/models/transaction_type.dart`):
```dart
enum TransactionType {
  debt,
  loan
}
```

**Currency enum** (`lib/data/models/currency.dart`):
```dart
enum Currency {
  pln,
  eur,
  usd,
  gbp
}
```

**TransactionStatus enum** (`lib/data/models/transaction_status.dart`):
```dart
enum TransactionStatus {
  active,
  completed
}
```

### 4. Implement Transaction Model Class

**Key features:**
- Isar collection class with `@collection` annotation
- Use `@Enumerated(EnumType.name)` for enum fields
- Amount stored as `int` (smallest currency unit, e.g., grosze for PLN)
- ID field with type `Id` (auto-increment by default)
- No manual `copyWith` needed - Isar generates helper methods
- Add validation in constructor/setters if needed

**Example structure:**
```dart
@collection
class Transaction {
  Id id = Isar.autoIncrement;

  @Enumerated(EnumType.name)
  late TransactionType type;

  late String name;
  late int amount;

  @Enumerated(EnumType.name)
  late Currency currency;

  String? description;
  DateTime? dueDate;

  @Enumerated(EnumType.name)
  late TransactionStatus status;

  late DateTime createdAt;
  late DateTime updatedAt;
}
```

### 5. Generate Isar Code
Run build_runner to generate the `*.g.dart` file:
```bash
dart run build_runner build --delete-conflicting-outputs
```

### 6. Create Helper Methods and Getters

Consider adding to the Transaction class:
- `bool get isOverdue` - Check if transaction is overdue
- `bool get isActive` - Check if transaction is active
- `bool get isCompleted` - Check if transaction is completed
- `double get amountInMainUnit` - Convert amount from smallest unit to main unit (e.g., grosze to PLN)

### 7. Validation

Add validation logic:
- Name must not be empty
- Amount must be positive
- Description max 200 characters (if provided)

### 8. Testing

Create test file: `test/data/models/transaction_test.dart`

**Test cases:**
- Model creation with all fields
- Model creation with minimal fields (only required)
- Isar collection operations (save, read, update, delete)
- Validation rules (name, amount, description length)
- Helper methods (isOverdue, isActive, isCompleted, amountInMainUnit)
- Enum storage and retrieval
- Query operations

### 9. Documentation

Add dartdoc comments to:
- Class definition
- All public fields
- Getters and methods

## File Structure
```
lib/
  data/
    models/
      transaction.dart
      transaction.g.dart (generated by Isar)
      transaction_type.dart
      currency.dart
      transaction_status.dart

test/
  data/
    models/
      transaction_test.dart
```

## Dependencies (already added)
```yaml
dependencies:
  isar_community: ^4.0.3
  isar_community_flutter_libs: ^4.0.3
  path_provider: ^2.1.5

dev_dependencies:
  isar_community_generator: ^4.0.3
  build_runner: ^2.4.0
```

## Verification Steps
1. Run `dart run build_runner build --delete-conflicting-outputs` - code generation succeeds
2. Run `flutter analyze` - no errors
3. Run `flutter test` - all tests pass
4. Verify Isar collection is properly registered
5. Verify all enum values are stored/retrieved correctly as names
6. Verify validation rules work as expected
7. Verify amount is correctly stored as int (smallest unit)

## Success Criteria
- Transaction model created as Isar collection with all required fields
- Enums defined for type, currency, and status
- Isar code generation working (*.g.dart created)
- Amount stored as `int` in smallest currency unit
- Helper getter for converting amount to main unit
- Validation logic in place
- Unit tests written and passing
- No analyzer warnings
- Code follows Dart style guidelines

## Related Tasks
- TASK-0009: Create Repayment Model (depends on Transaction model)
- TASK-0010: Create Reminder Model (depends on Transaction model)
- TASK-0011: Implement Transaction Repository (uses Transaction model)

## Notes
- This is a foundational model for the entire application
- Transaction is an Isar collection stored in local database
- Ensure proper null safety usage
- Amount is stored as `int` to avoid floating-point precision issues
- Enums are stored using `@Enumerated(EnumType.name)` for readability in database
